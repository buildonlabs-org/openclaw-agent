OpenClaw Gateway - Complete Setup Solution
==========================================

KEY CHANGES:
-----------
1. Gateway auto-generates secure token and displays it in logs
2. Device management API added for web-based pairing
3. **CRITICAL: Gateway now auto-configures to bypass device pairing**
4. **NEW: Automatic onboarding on first deployment**


AUTOMATIC ONBOARDING:
--------------------
On first deployment, the container now automatically:
1. Runs `openclaw onboard --non-interactive`
2. Configures OpenAI API credentials from OPENAI_API_KEY
3. Sets default model from OPENAI_MODEL (defaults to gpt-4o-mini)
4. Configures gateway token authentication
5. Creates persistent config in /data/.openclaw/openclaw.json

This fixes the issue where gateway defaulted to Claude even with
OpenAI credentials configured.

**Environment Variables for Onboarding:**
- OPENAI_API_KEY (required) - Your OpenAI API key
- OPENAI_MODEL (optional) - Model name (default: gpt-4o-mini)
- OPENCLAW_GATEWAY_TOKEN (optional) - Auto-generated if not provided


DEVICE PAIRING SOLUTION:
------------------------
The container automatically configures the gateway to bypass device pairing by
setting `gateway.controlUi.allowInsecureAuth=true` during startup.

**Why this works:**
- OpenClaw's Control UI normally requires device pairing for security
- Setting `allowInsecureAuth=true` bypasses the pairing requirement
- Gateway auth is still enforced via bearer token (secure)
- This matches the approach used by other Railway templates

**What happens on startup:**
1. Container runs: `openclaw config set gateway.controlUi.allowInsecureAuth true`
2. Container runs: `openclaw config set gateway.trustedProxies ["127.0.0.1"]`
3. Gateway starts with token auth enabled
4. Users can connect immediately without device pairing

**Fallback Device Management API:**
If pairing is still needed for specific channels (Telegram/Discord):
  GET  /api/devices          ‚Üí List all devices (pending and approved)
  POST /api/devices/approve  ‚Üí Approve a device by requestId

Launcher UI shows "üîê Pair Device" button for Telegram/Discord channel pairing.


AUTHENTICATION:
--------------
1. Gateway REQUIRES authentication (cannot run without it)

2. Auto-generated token printed to logs:
   ‚Üí Token generated using openssl rand -hex 32 (64 characters)
   ‚Üí Displayed in Railway logs during startup
   ‚Üí Look for: "üîë Copy this token to connect to your gateway:"
   ‚Üí Token changes on each restart (unless OPENCLAW_GATEWAY_TOKEN is set)

3. Persistent token option:
   ‚Üí Set OPENCLAW_GATEWAY_TOKEN env var for static token
   ‚Üí Recommended for production deployments
   ‚Üí Persists across container restarts


HOW TO CONNECT:
---------------
1. Deploy the app to Railway
2. Check Railway logs for startup output
3. Find the line: "üîë Copy this token to connect to your gateway:"
4. Copy the token from the next line
5. Use token when connecting to the gateway

For launcher deployments:
  ‚Üí Token is passed automatically via OPENCLAW_GATEWAY_TOKEN
  ‚Üí Stored securely in deployment database
  ‚Üí Available in launcher UI with copy button


FOR PERSISTENT TOKEN:
--------------------
Set environment variable before deploy:
  OPENCLAW_GATEWAY_TOKEN=<your-secure-token>

Generate secure token:
  openssl rand -hex 32


SECURITY:
--------
‚úì Token NOT exposed via public web endpoints
‚úì Only visible in deployment logs (secure)
‚úì Launcher stores tokens securely in database
‚úì Each deployment gets unique token


BEHAVIOR:
--------
‚úì Gateway starts with auth enabled
‚úì Token auto-generated if not provided
‚úì Token printed clearly in logs
‚úì Secure: no public endpoint exposure
‚úì Clients connect using the token from logs or launcher UI
